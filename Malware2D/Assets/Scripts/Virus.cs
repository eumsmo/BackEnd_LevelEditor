using UnityEngine;

public class Virus : Andavel {
    public int energia = 10;

    public void InicializarObjeto() {
        if (objeto != null) return;

        objeto = new Objeto();
        objeto.tipo = TipoObjeto.NENHUM;
        objeto.posicao = new GridPos(0, 0);
        objeto.direcao = Direcao.CIMA;
        
        MapManager.instance.CadastrarObjeto(objeto, gameObject);
    }

    public override bool Andar(Vector2 direcao) {
        if (energia <= 0) return false;
        
        if (!base.Andar(direcao)) return false;
        energia--;

        return true;
    }

    public override bool FazerAcao() {
        GridPos posicaoEmFrente = new GridPos(objeto.posicao.x, objeto.posicao.y);
        posicaoEmFrente.Mover(objeto.direcao);

        Objeto objetoEmFrente = MapManager.instance.GetObjetoAt(posicaoEmFrente.x, posicaoEmFrente.y);
        
        if (objetoEmFrente != null) {
            Controlavel controlavel = MapManager.instance.GetInstance(objetoEmFrente).GetComponent<Controlavel>();
            if (controlavel == null) return false;
            
            if (Player.instance.InfectarObjeto(controlavel)) {
                gameObject.SetActive(false);
                return true;
            }
        }

        return false;
    }
}
